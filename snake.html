<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        #gameBoard {
            border-radius: 100px;
            display: grid;
            grid-template-columns: repeat(20, 27px);
            grid-template-rows: repeat(20, 27px);
            margin: 5px;
        }

        .gameBorder1 {
            border: 10px solid #595f43;
            border-radius: 30px;
            box-shadow: inset 0 0 0 10px #595f43;
        }

        .gameBorder2 {
            border: 8px solid #abb78a;
            border-radius: 26px;
            box-shadow: inset 0 0 0 10px #abb78a;
        }

        .gameBorder3 {
            border: 30px solid #8b966c;
            border-radius: 20px;
            box-shadow: inset 0 0 0 5px #8b966c;
            background-color: #c4cfa3;
        }

        #instruction {
            position: absolute;
            color: #333;
            width: 400px;
            text-align: center;
            text-transform: capitalize;
            padding: 30px;
            margin: 0;
        }

        .scores {
            display: flex;
            justify-content: space-between;
        }

        #score {
            color: #abb78a;
        }

        #highScore {
            color: #d8ddca;
        }

        #score,
        #highScore {
            font-size: 40px;
            font-weight: bolder;
            margin: 10px 0;
        }

        .snake {
            border: 1px dotted #5a5a5a;
            background-color: #414141;
        }

        .food {
            background-color: #ff0000;
            border: 5px solid #9f1f1fc8;
        }

        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            font-size: 30px;
            text-align: center;
            display: none;
        }

        #retryButton {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 20px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div>
        <div class="scores">
            <h1 id="score"> 000 </h1>
            <h1 id="highScore"> 000 </h1>
        </div>

        <div class="gameBorder1">
            <div class="gameBorder2">
                <div class="gameBorder3">
                    <div id="gameBoard"></div>
                </div>
            </div>
        </div>
    </div>

    <h1 id="instruction">Trykk spacebar for Ã¥ starte</h1>

    <script>
        const board = document.getElementById("gameBoard");
        const gridSize = 20;
        const instruction = document.getElementById("instruction");
        const score = document.getElementById("score");
        const highScoreText = document.getElementById("highScore");

        let snake = [{ x: 10, y: 10 }];
        let food = generateFood();
        let highScore = 0;
        let direction = 'right';
        let gameInterval;
        let gameSpeedDelay = 200;
        let gameStarted = false;

        function draw() {
            board.innerHTML = '';
            drawSnake();
            drawFood();
            updateScore();
        }

        function drawSnake() {
            snake.forEach((segment) => {
                const snakeEl = createGameElement("div", "snake");
                setPosition(snakeEl, segment)
                board.appendChild(snakeEl)
            });
        }

        function createGameElement(tag, className) {
            const element = document.createElement(tag);
            element.className = className;
            return element;
        }

        function setPosition(element, position) {
            element.style.gridColumn = position.x;
            element.style.gridRow = position.y;
        }

        function drawFood() {
            if (gameStarted) {
                const foodEl = createGameElement("div", "food")
                setPosition(foodEl, food)
                board.appendChild(foodEl)
            }
        }

        function generateFood() {
            const x = Math.floor(Math.random() * gridSize) + 1;
            const y = Math.floor(Math.random() * gridSize) + 1;
            return { x, y };
        }

        function move() {
            const head = { ...snake[0] }
            switch (direction) {
                case 'up':
                    head.y--;
                    break;
                case 'down':
                    head.y++;
                    break;
                case 'left':
                    head.x--;
                    break;
                case 'right':
                    head.x++;
                    break;
            }

            snake.unshift(head);

            if (head.x === food.x && head.y === food.y) {
                food = generateFood();
                increaseSpeed();
                clearInterval(gameInterval);
                gameInterval = setInterval(() => {
                    move();
                    checkCollision();
                    draw();
                }, gameSpeedDelay);
            }
            else {
                snake.pop();
            }
        }

        function startGame() {
            gameStarted = true;
            instruction.style.display = "none";
            gameInterval = setInterval(() => {
                move();
                checkCollision();
                draw();
            }, gameSpeedDelay)
        }

        function handleKeypress(event) {
            if (!gameStarted && event.code === "Space") {
                startGame();
            }
            else {
                switch (event.key) {
                    case "ArrowUp":
                        if (direction !== "down") direction = "up";
                        break;
                    case "ArrowDown":
                        if (direction !== "up") direction = "down";
                        break;
                    case "ArrowLeft":
                        if (direction !== "right") direction = "left";
                        break;
                    case "ArrowRight":
                        if (direction !== "left") direction = "right";
                        break;
                }
            }
        }

        document.addEventListener("keydown", handleKeypress);

        function increaseSpeed() {
            if (gameSpeedDelay > 150) {
                gameSpeedDelay -= 5;
            }
            else if (gameSpeedDelay > 100) {
                gameSpeedDelay -= 3;
            }
            else if (gameSpeedDelay > 50) {
                gameSpeedDelay -= 2;
            }
            else if (gameSpeedDelay > 25) {
                gameSpeedDelay -= 1;
            }
        }

        function checkCollision() {
            const head = snake[0];

            if (head.x < 1 || head.x > gridSize ||
                head.y < 1 || head.y > gridSize) {
                resetGame();
            }

            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    resetGame();
                }
            }
        }

        function gameOver() {
            updateHighScore();
            stopGame();
            gameOverScreen.innerHTML = `<p>Game Over!</p>`;
            gameOverScreen.appendChild(retryButton);
            gameOverScreen.style.display = "block";
        }

        function resetGame() {
            snake = [{ x: 10, y: 10 }]
            food = generateFood();
            direction = "right"
            gameSpeedDelay = 200;
            updateScore();
            instruction.style.display = "block";
            gameStarted = false;
            clearInterval(gameInterval);
        }

        function updateScore() {
            const currentScore = snake.length - 1;
            score.textContent = currentScore.toString().padStart(3, "0");
        }

        function stopGame() {
            clearInterval(gameInterval);
            instruction.style.display = "block";
            document.body.appendChild(gameOverScreen);
        }

        function updateHighScore() {
            const currentScore = snake.length - 1;
            if (currentScore > highScore) {
                highScore = currentScore;
                highScoreText.textContent = highScore.toString().padStart(3, "0")
            }
            highScoreText.style.display = "block"
        }

    </script>
</body>

</html>